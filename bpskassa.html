<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BPS.system ‚Äî Kassa</title>

  <style>
    :root{
      --bg:#07121b;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);

      --ok:#10b981;
      --bad:#f16262; /* –º—è–≥–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π –∫–∞–∫ —Ç—ã –ø—Ä–æ—Å–∏–ª */
      --shadow: 0 10px 30px rgba(0,0,0,.25);

      --r: 16px;
      --gap: 12px;

      --sidebar-collapsed: 64px;
      --sidebar-expanded: 230px;

      --topH: 35vh;     /* –≤–µ—Ä—Ö 35% */
      --bottomH: 65vh;  /* –Ω–∏–∑ 65% */
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(1000px 520px at 18% 12%, rgba(16,185,129,.18), transparent 60%),
        radial-gradient(900px 520px at 88% 38%, rgba(59,130,246,.14), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    /* ---------- Shell ---------- */
    .appShell{
      height:100vh;
      display:flex;
      min-height:0;
    }

    /* ---------- Sidebar (desktop) ---------- */
    .sidebar{
      width: var(--sidebar-collapsed);
      transition: width .22s ease;
      border-right: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      padding: 12px 10px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height:0;
      position:relative;
    }
    .sidebar:hover{ width: var(--sidebar-expanded); }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
    }
    .brandLogo{
      width: 34px; height: 34px;
      border-radius: 12px;
      background: rgba(16,185,129,.18);
      border: 1px solid rgba(16,185,129,.30);
      display:grid; place-items:center;
      font-weight: 900;
      color: rgba(16,185,129,.95);
      flex: 0 0 34px;
    }
    .brandText{
      font-weight: 900;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      opacity:0;
      transform: translateX(-4px);
      transition: opacity .16s ease, transform .16s ease;
    }
    .sidebar:hover .brandText{
      opacity:1;
      transform: translateX(0);
    }

    .nav{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding-top: 6px;
      min-height:0;
    }

    .navItem{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      color: rgba(255,255,255,.85);
      text-decoration:none;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      user-select:none;
    }
    .navItem:hover{
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.08);
    }
    .navItem.active{
      background: rgba(16,185,129,.12);
      border-color: rgba(16,185,129,.28);
      color: rgba(255,255,255,.95);
    }
    .navIcon{
      width: 22px; height: 22px;
      display:grid;
      place-items:center;
      flex: 0 0 22px;
      opacity:.95;
    }
    .navText{
      white-space:nowrap;
      overflow:hidden;
      opacity:0;
      transform: translateX(-4px);
      transition: opacity .16s ease, transform .16s ease;
    }
    .sidebar:hover .navText{
      opacity:1;
      transform: translateX(0);
    }

    .sidebarFoot{
      margin-top:auto;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.55);
      font-size: 12px;
      padding-left: 10px;
      padding-right: 10px;
      opacity:0;
      transform: translateX(-4px);
      transition: opacity .16s ease, transform .16s ease;
    }
    .sidebar:hover .sidebarFoot{
      opacity:1;
      transform: translateX(0);
    }

    /* ---------- Main ---------- */
    .main{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    /* header (desktop+mobile) */
    .topHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      backdrop-filter: blur(10px);
    }
    .hdrLeft{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .hdrTitle{
      font-weight: 900;
      font-size: 14px;
      letter-spacing:.25px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hdrSub{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hdrRight{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding: 9px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 13px;
      white-space:nowrap;
    }
    .pill.ok{ color: rgba(16,185,129,.95); border-color: rgba(16,185,129,.30); background: rgba(16,185,129,.10); }
    .pill.err{ color: rgba(241,98,98,.95); border-color: rgba(241,98,98,.28); background: rgba(241,98,98,.10); }

    .btn{
      border:0;
      border-radius: 12px;
      padding: 9px 12px;
      font-weight: 900;
      cursor:pointer;
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.10);
      white-space:nowrap;
    }
    .btn.primary{
      background: var(--ok);
      color:#062a1b;
      border-color: rgba(16,185,129,.35);
      box-shadow: var(--shadow);
    }
    .btn:disabled{ opacity:.7; cursor:not-allowed; }

    .spinner{
      width: 16px; height: 16px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,.18);
      border-top-color: rgba(255,255,255,.75);
      animation: spin .8s linear infinite;
      flex: 0 0 16px;
    }
    @keyframes spin { to { transform: rotate(360deg);} }

    /* content layout: top 35% + bottom 65% */
    .content{
      flex:1;
      min-height:0;
      padding: var(--gap);
      display:flex;
      flex-direction:column;
      gap: var(--gap);
      overflow:hidden;
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: none;
      min-height:0;
    }

    .topArea{
      height: var(--topH);
      min-height: 260px;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr; /* 33% / 33% / 33% */
      gap: var(--gap);
      min-height:0;
    }

    /* balances card */
    .balancesCard{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }
    .cardTitleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .cardTitle{
      font-weight: 1000;
      letter-spacing:.2px;
      font-size: 14px;
    }
    .muted{ color: rgba(255,255,255,.62); font-size: 12px; }

    .balList{
      display:grid;
      gap:10px;
      overflow:auto;
      padding-right: 2px;
      min-height:0;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.22) transparent;
    }
    .balList::-webkit-scrollbar{ width: 10px; }
    .balList::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      border: 2px solid transparent;
      background-clip: content-box;
    }
    .balList:hover::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.30);
      background-clip: content-box;
    }
    .balItem{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .balItem .w{ font-weight: 900; }
    .balItem .nums{
      text-align:right;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      color: rgba(255,255,255,.88);
      line-height: 1.25;
    }

    /* filters card */
    .filtersCard{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }
    .filtersGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      min-height:0;
    }
    .filtersGrid .full{ grid-column: 1 / -1; }

    .field{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      min-height: 40px;
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .field input, .field select{
      width:100%;
      border:0;
      outline:none;
      background: transparent;
      color: rgba(255,255,255,.92);
      font-size: 13px;
      padding:0;
    }
    input[type="date"]{
      color: rgba(255,255,255,.92);
      background: transparent;
    }

    /* select readable */
    select{
      background: rgba(10,18,26,.65);
      border-radius: 10px;
      padding: 6px 10px;
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.12);
    }
    option{ color:#0b1220; background:#fff; }

    /* category summary card */
    .catCard{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }
    .catTotals{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    .totBox{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      min-height: 54px;
    }
    .totLbl{
      font-size:11px;
      color: rgba(255,255,255,.68);
      text-transform: uppercase;
      letter-spacing:.2px;
      font-weight: 900;
    }
    .totVal{
      margin-top: 6px;
      font-weight: 1000;
      font-size: 13px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .in{ color: rgba(16,185,129,.95); }
    .out{ color: rgba(241,98,98,.95); }

    .catListWrap{
      overflow:auto;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 12px;
      min-height:0;
      flex:1;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.22) transparent;
    }
    .catListWrap::-webkit-scrollbar{ width: 10px; }
    .catListWrap::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      border: 2px solid transparent;
      background-clip: content-box;
    }
    .catListWrap:hover::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.30);
      background-clip: content-box;
    }
    .catTable{
      width:100%;
      border-collapse: collapse;
    }
    .catTable thead th{
      position: sticky;
      top: 0;
      z-index: 2;
      text-align:left;
      padding: 10px 10px;
      font-size: 11px;
      letter-spacing:.2px;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
      background: rgba(10,18,26,.96);
      border-bottom: 1px solid rgba(255,255,255,.10);
      white-space: nowrap;
    }
    .catTable tbody td{
      padding: 8px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      font-size: 12px;
      white-space: nowrap;
    }
    .catName{
      font-weight: 900;
      color: rgba(255,255,255,.92);
      max-width: 220px;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      color: rgba(255,255,255,.88);
    }

    /* bottom table */
    .bottomArea{
      height: var(--bottomH);
      min-height: 320px;
      padding: 0;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .tableScroll{
      flex:1;
      min-height:0;
      overflow:auto; /* BOTH directions */
      scrollbar-gutter: stable;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.22) transparent;
    }
    .tableScroll::-webkit-scrollbar{ width: 10px; height: 10px; }
    .tableScroll::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      border: 2px solid transparent;
      background-clip: content-box;
    }
    .tableScroll:hover::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.30);
      background-clip: content-box;
    }

    table.opsTable{
      width:100%;
      border-collapse: collapse;
      min-width: 1200px; /* —á—Ç–æ–±—ã –∫–æ–ª–æ–Ω–∫–∏ —Ç–æ—á–Ω–æ –≤–ª–µ–∑–ª–∏ —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º */
    }
    table.opsTable thead th{
      position: sticky;
      top: 0;
      z-index: 2;
      text-align:left;
      padding: 10px 12px;
      font-size: 11px;
      letter-spacing:.2px;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
      background: rgba(10,18,26,.96);
      border-bottom: 1px solid rgba(255,255,255,.10);
      white-space: nowrap;
    }
    table.opsTable tbody td{
      padding: 8px 12px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      font-size: 13px;
      white-space: nowrap;
      max-width: 420px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    table.opsTable tbody tr:hover td{ background: rgba(255,255,255,.03); }

    .amtIn{ color: rgba(16,185,129,.95); font-weight: 900; }
    .amtOut{ color: rgba(241,98,98,.95); font-weight: 900; }

    .empty{
      padding: 16px 12px;
      color: var(--muted);
      font-size: 13px;
    }

    /* ---------- Login overlay ---------- */
    .overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 16px;
      background: rgba(3,7,12,.62);
      backdrop-filter: blur(8px);
      z-index: 80;
    }
    .loginCard{
      width: min(440px, 100%);
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .loginCard h2{ margin:0; font-size: 18px; }
    .loginCard p{ margin:8px 0 14px; color:var(--muted); font-size: 13px; }
    .loginGrid{ display:grid; gap:10px; margin-top:10px; }
    .loginActions{ display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }

    /* ---------- Mobile ---------- */
    .burger{
      display:none;
      width: 42px;
      height: 38px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }

    .mobileMenuOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      z-index: 70;
      display:none;
    }
    .mobileMenu{
      width: 78%;
      max-width: 320px;
      height: 100%;
      background: rgba(8,16,24,.95);
      border-right: 1px solid rgba(255,255,255,.12);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .mNav a{
      display:block;
      padding: 12px 12px;
      border-radius: 14px;
      text-decoration:none;
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      font-weight: 900;
    }
    .mNav a.active{
      background: rgba(16,185,129,.12);
      border-color: rgba(16,185,129,.30);
    }

    /* mobile ops list (cards) */
    .opsCards{
      display:none;
      padding: 12px;
      gap:10px;
    }
    .opCard{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      border-radius: 14px;
      padding: 12px;
      display:grid;
      gap:6px;
    }
    .opTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-weight: 900;
    }
    .opMid{
      color: rgba(255,255,255,.78);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .opNote{
      color: rgba(255,255,255,.70);
      font-size: 12px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .opAmts{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:4px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
    }
    .opAmts .box{
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 12px;
      padding: 8px 10px;
      background: rgba(255,255,255,.03);
    }
    .opAmts .lbl{ color: rgba(255,255,255,.62); font-size: 11px; text-transform: uppercase; letter-spacing:.2px; font-weight: 900;}
    .opAmts .val{ margin-top:4px; font-weight: 1000; }

    @media (max-width: 980px){
  /* —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ ‚Äú–¥–≤–æ–π–Ω–æ–≥–æ‚Äù —Å–∫—Ä–æ–ª–ª–∞ –∏ —Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–µ–π iOS */
  html, body{ height:auto; }
  body{ overflow:auto; }

  .appShell{ height:auto; min-height:100vh; }
  .main{ min-height:100vh; }

  .sidebar{ display:none; }
  .content{
    flex:none;
    overflow:visible;
    padding: 12px;
    gap: 10px;
  }

  .burger{ display:inline-flex; align-items:center; justify-content:center; }

  .topArea{
    height:auto;
    min-height:0;
    grid-template-columns: 1fr;
    gap: 10px;
  }

  .bottomArea{
    height:auto;
    min-height:0;
    overflow:visible;
  }

  /* –≤ –º–æ–±–∏–ª–∫–µ: —Ç–∞–±–ª–∏—Ü—É –ø—Ä—è—á–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ */
  .tableScroll{ display:none; }
  .opsCards{ display:grid; padding: 0; }

  /* --- –§–ò–õ–¨–¢–†–´: –≤ 1 –∫–æ–ª–æ–Ω–∫—É, –±–µ–∑ –Ω–∞–ª–æ–∂–µ–Ω–∏–π --- */
  .filtersGrid{ grid-template-columns: 1fr; }
  .filtersGrid .full{ grid-column: 1 / -1; }

  .filtersCard .field{
    flex-direction: column;
    align-items: stretch;
    gap: 6px;
    padding: 12px;
    min-height: auto;
  }

  .filtersCard .field label{
    width:100%;
    white-space: normal; /* –¥–ª–∏–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ –±–æ–ª—å—à–µ –Ω–µ –ª–æ–º–∞—é—Ç */
    line-height: 1.2;
  }

  /* –≤–∞–∂–Ω–æ –¥–ª—è iPhone: —á—Ç–æ–±—ã –ù–ï –±—ã–ª–æ –∞–≤—Ç–æ-zoom */
  .filtersCard .field input,
  .filtersCard .field select{
    width:100%;
    font-size: 16px;
  }

  /* date range: –ø–µ—Ä–µ–Ω–æ—Å–∏–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∏—Ä–µ —Å–∫—Ä—ã–≤–∞–µ–º */
  .filtersCard .field.full{ flex-wrap: wrap; }
  .filtersCard .field.full span.muted{ display:none; }

  /* –¥–µ–ª–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã ‚Äú—Ç—ë–º–Ω—ã–º–∏‚Äù –≤ Safari */
  html{ color-scheme: dark; }

  /* –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/–∏—Ç–æ–≥–∏: –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
  .catTotals{ grid-template-columns: 1fr 1fr; }

  /* –∫–∞—Ä—Ç–æ—á–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –æ—á–µ–Ω—å —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
  .opAmts{ grid-template-columns: 1fr 1fr; }
}

@media (max-width: 420px){
  .catTotals{ grid-template-columns: 1fr; }
  .opAmts{ grid-template-columns: 1fr; }
}

  </style>
</head>

<body>
  <!-- LOGIN -->
  <div id="loginOverlay" class="overlay">
    <div class="loginCard">
      <h2>BPS.system</h2>
      <p>Login/Parol tekshiriladi (Users). So‚Äòng baza yuklanadi.</p>

      <div class="loginGrid">
        <div class="field">
          <label>Login</label>
          <input id="login" autocomplete="username" placeholder="login"/>
        </div>
        <div class="field">
          <label>Parol</label>
          <input id="pass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
        </div>
      </div>

      <div class="loginActions">
        <span id="loginMsg" class="pill" style="display:none;"></span>
        <button id="btnLogin" class="btn primary" type="button">Kirish</button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mOverlay" class="mobileMenuOverlay">
    <div class="mobileMenu" onclick="event.stopPropagation()">
      <div class="brand" style="margin-bottom:6px;">
        <div class="brandLogo">B</div>
        <div class="brandText" style="opacity:1;transform:none;">BPS.system</div>
      </div>
      <div class="mNav" id="mNav"></div>
      <div class="muted" style="margin-top:auto;">BPS.system</div>
    </div>
  </div>

  <div class="appShell">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="brandLogo">B</div>
        <div class="brandText">BPS.system</div>
      </div>

      <nav class="nav" id="nav"></nav>

      <div class="sidebarFoot">BPS.system</div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topHeader">
        <div class="hdrLeft">
          <div class="hdrTitle">BPS.system</div>
          <div class="hdrSub">Kassa server ‚Äî filtr / kategoriya / operatsiyalar</div>
        </div>

        <div class="hdrRight">
          <span id="userPill" class="pill">üë§ -</span>
          <button id="btnReload" class="btn">Yangilash</button>
          <span id="status" class="pill"><span class="muted">Tayyor</span></span>
          <button id="burger" class="burger" title="Menu">‚ò∞</button>
        </div>
      </header>

      <section class="content">
        <!-- TOP 35% -->
        <div class="topArea">
          <!-- balances -->
          <div class="card balancesCard">
            <div class="cardTitleRow">
              <div class="cardTitle">Qoldiq (hamma sana bo‚Äòyicha)</div>
              <span id="updatedAt" class="muted"></span>
            </div>
            <div id="balances" class="balList"></div>
          </div>

          <!-- filters -->
          <div class="card filtersCard">
            <div class="cardTitleRow">
              <div class="cardTitle">Filtrlar</div>
              <button id="btnClear" class="btn" type="button">Reset</button>
            </div>

            <div class="filtersGrid">
              <div class="field full">
                <label>–î–∞—Ç–∞ –æ—Ç / –¥–æ</label>
                <input id="dateFrom" type="date"/>
                <span class="muted">‚Äî</span>
                <input id="dateTo" type="date"/>
              </div>

              <div class="field">
                <label>–ü–æ –∫–æ—à–µ–ª—å–∫–∞–º</label>
                <select id="fWallet">
                  <option value="all">–í—Å–µ</option>
                </select>
              </div>

              <div class="field">
                <label>–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</label>
                <select id="fCat">
                  <option value="all">–í—Å–µ</option>
                </select>
              </div>

              <div class="field">
                <label>–ü–æ —Å—É–± –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</label>
                <select id="fSub">
                  <option value="all">–í—Å–µ</option>
                </select>
              </div>

              <div class="field">
                <label>–¢–∏–ø—ã (–†–∞—Å—Ö–æ–¥/–ü—Ä–∏—Ö–æ–¥)</label>
                <select id="fType">
                  <option value="all">–í—Å–µ</option>
                  <option value="in">–ü—Ä–∏—Ö–æ–¥</option>
                  <option value="out">–†–∞—Å—Ö–æ–¥</option>
                </select>
              </div>

              <div class="field">
                <label>–í–∞–ª—é—Ç–∞</label>
                <select id="fCur">
                  <option value="all">–í—Å–µ</option>
                  <option value="uzs">UZS</option>
                  <option value="usd">USD</option>
                  <option value="both">UZS+USD</option>
                </select>
              </div>
            </div>
          </div>

          <!-- categories summary -->
          <div class="card catCard">
            <div class="cardTitleRow">
              <div class="cardTitle">Kategoriya bo‚Äòyicha</div>
              <span class="muted">filtr bo‚Äòyicha</span>
            </div>

            <div class="catTotals">
              <div class="totBox">
                <div class="totLbl">Kirim UZS</div>
                <div id="tInU" class="totVal in">0</div>
              </div>
              <div class="totBox">
                <div class="totLbl">Chiqim UZS</div>
                <div id="tOutU" class="totVal out">0</div>
              </div>
              <div class="totBox">
                <div class="totLbl">Kirim USD</div>
                <div id="tInD" class="totVal in">0</div>
              </div>
              <div class="totBox">
                <div class="totLbl">Chiqim USD</div>
                <div id="tOutD" class="totVal out">0</div>
              </div>
            </div>

            <div class="catListWrap">
              <table class="catTable">
                <thead>
                  <tr>
                    <th>Kategoriya</th>
                    <th>Kirim UZS</th>
                    <th>Chiqim UZS</th>
                    <th>Kirim USD</th>
                    <th>Chiqim USD</th>
                  </tr>
                </thead>
                <tbody id="catBody">
                  <tr><td colspan="5" class="empty">Operatsiyalar yoq</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- BOTTOM 65% -->
        <div class="card bottomArea">
          <!-- desktop table -->
          <div class="tableScroll" id="tableScroll">
            <table class="opsTable">
              <thead>
                <tr>
                  <th>Sana</th>
                  <th>Koshelok</th>
                  <th>Kategoriya</th>
                  <th>Subkategoriya</th>
                  <th>Izoh</th>
                  <th>Kirim Summa</th>
                  <th>Chiqim summa</th>
                  <th>Kirim $ Summa</th>
                  <th>Chiqim $ summa</th>
                  <th>Kurs</th>
                </tr>
              </thead>
              <tbody id="tbody">
                <tr><td colspan="10" class="empty">Operatsiyalar yoq</td></tr>
              </tbody>
            </table>
          </div>

          <!-- mobile cards -->
          <div id="opsCards" class="opsCards"></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    /************ CONFIG ************/
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbyZD2z3CcNpQhGFh-e_Qfmhu91B7imqNKQ0dr2Gm4_V2KzTlvNEJMpRYnjOAfu_CCwiQg/exec"; // <-- —Å—é–¥–∞ .../exec
    const API_SECRET = "bpsSecret123"; // –µ—Å–ª–∏ –≤–∫–ª—é—á–∏–ª API_SECRET –≤ Apps Script ‚Äî –ø—Ä–æ–ø–∏—à–∏ —Ç—É—Ç

    /************ NAV CONFIG ************/
    const NAV_ITEMS = [
      { key:"home",  label:"–ì–ª–∞–≤–Ω–∞—è",       href:"/bpsmain",  icon: homeIcon() },
      { key:"kassa", label:"–ö–∞—Å—Å–∞",         href:"/bpskassa", icon: cashIcon() },
      { key:"prod",  label:"–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",  href:"/bpsprod",  icon: factoryIcon() },
      { key:"sale",  label:"–ü—Ä–æ–¥–∞–∂–∞",       href:"/bpssale",  icon: saleIcon() },
      { key:"stock", label:"–°–∫–ª–∞–¥",         href:"/bpsstock", icon: boxIcon() },
      { key:"users", label:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",  href:"/bpsusers", icon: usersIcon() },
    ];

    function currentKeyFromPath(){
      const p = (location.pathname || "").toLowerCase();
      if (p.includes("bpskassa")) return "kassa";
      if (p.includes("bpsmain")) return "home";
      if (p.includes("bpsprod")) return "prod";
      if (p.includes("bpssale")) return "sale";
      if (p.includes("bpsstock")) return "stock";
      if (p.includes("bpsusers")) return "users";
      return "kassa"; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }

    function renderNav(){
      const activeKey = currentKeyFromPath();
      const nav = document.getElementById("nav");
      const mNav = document.getElementById("mNav");

      nav.innerHTML = NAV_ITEMS.map(i => `
        <a class="navItem ${i.key===activeKey ? "active":""}" href="${i.href}">
          <span class="navIcon">${i.icon}</span>
          <span class="navText">${escapeHtml(i.label)}</span>
        </a>
      `).join("");

      // mobile: —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç—ã
      mNav.innerHTML = NAV_ITEMS.map(i => `
        <a class="${i.key===activeKey ? "active":""}" href="${i.href}">${escapeHtml(i.label)}</a>
      `).join("");
    }

    /************ STATE ************/
    let TOKEN = localStorage.getItem("bps_token") || "";
    let USER = null;

    let ALL_ROWS = [];
    let OPTIONS = { wallets:[], categories:[], subAll:[], subByCat:{} };
    let BALANCES = [];

    /************ DOM ************/
    const loginOverlay = document.getElementById("loginOverlay");
    const btnLogin = document.getElementById("btnLogin");
    const loginMsg = document.getElementById("loginMsg");
    const inpLogin = document.getElementById("login");
    const inpPass = document.getElementById("pass");

    const userPill = document.getElementById("userPill");
    const status = document.getElementById("status");
    const btnReload = document.getElementById("btnReload");
    const btnClear = document.getElementById("btnClear");
    const updatedAt = document.getElementById("updatedAt");

    const dateFrom = document.getElementById("dateFrom");
    const dateTo = document.getElementById("dateTo");
    const fWallet = document.getElementById("fWallet");
    const fCat = document.getElementById("fCat");
    const fSub = document.getElementById("fSub");
    const fType = document.getElementById("fType");
    const fCur = document.getElementById("fCur");

    const balancesBox = document.getElementById("balances");

    const tbody = document.getElementById("tbody");
    const tableScroll = document.getElementById("tableScroll");

    const opsCards = document.getElementById("opsCards");

    const catBody = document.getElementById("catBody");

    const tInU = document.getElementById("tInU");
    const tOutU = document.getElementById("tOutU");
    const tInD = document.getElementById("tInD");
    const tOutD = document.getElementById("tOutD");

    // mobile menu
    const burger = document.getElementById("burger");
    const mOverlay = document.getElementById("mOverlay");

    /************ UI helpers ************/
    function setStatus(type, text, loading=false){
      status.className = "pill";
      status.innerHTML = "";
      if (loading) status.innerHTML = '<span class="spinner"></span>';
      status.innerHTML += `<span>${escapeHtml(text)}</span>`;
      if (type === "ok") status.classList.add("ok");
      if (type === "err") status.classList.add("err");
    }

    function setLoginMsg(type, text, loading=false){
      loginMsg.style.display = "inline-flex";
      loginMsg.className = "pill";
      loginMsg.innerHTML = "";
      if (loading) loginMsg.innerHTML = '<span class="spinner"></span>';
      loginMsg.innerHTML += `<span>${escapeHtml(text)}</span>`;
      if (type === "ok") loginMsg.classList.add("ok");
      if (type === "err") loginMsg.classList.add("err");
    }
    function hideLoginMsg(){ loginMsg.style.display = "none"; }

    function fmt(n){
      const x = Number(n);
      if (!isFinite(x)) return "0";
      return x.toLocaleString("ru-RU", { maximumFractionDigits: 2 });
    }
    function toNum(n){ const x = Number(n); return isFinite(x) ? x : 0; }

    function todayISO(){
      const d = new Date();
      const pad = x => String(x).padStart(2,"0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function isMobile(){
      return window.matchMedia("(max-width: 980px)").matches;
    }

    /************ JSONP ************/
    function loadJSONP(url){
      return new Promise((resolve, reject) => {
        const cbName = "__bps_cb_" + Math.random().toString(36).slice(2);
        const script = document.createElement("script");

        window[cbName] = (data) => { cleanup(); resolve(data); };
        function cleanup(){
          try { delete window[cbName]; } catch(e){ window[cbName] = undefined; }
          if (script.parentNode) script.parentNode.removeChild(script);
        }
        script.onerror = () => { cleanup(); reject(new Error("JSONP load error")); };

        const sep = url.includes("?") ? "&" : "?";
        script.src = url + sep + "callback=" + cbName + "&_=" + Date.now();
        document.body.appendChild(script);
      });
    }

    function apiUrl(params){
      const u = new URL(ENDPOINT);
      Object.entries(params).forEach(([k,v]) => u.searchParams.set(k, v));
      if (API_SECRET) u.searchParams.set("api_secret", API_SECRET);
      return u.toString();
    }

    async function apiLogin(login, parol){
      return await loadJSONP(apiUrl({ action:"login", login, parol }));
    }
    async function apiRefresh(token){
      return await loadJSONP(apiUrl({ action:"refresh", token }));
    }

    /************ render options/balances ************/
    function renderOptions(){
      fWallet.innerHTML = `<option value="all">–í—Å–µ</option>` + (OPTIONS.wallets || []).map(w =>
        `<option value="${escapeHtml(w)}">${escapeHtml(w)}</option>`
      ).join("");

      fCat.innerHTML = `<option value="all">–í—Å–µ</option>` + (OPTIONS.categories || []).map(c =>
        `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`
      ).join("");

      renderSubOptions("all");
    }

    function renderSubOptions(catVal){
      let list = [];
      if (catVal && catVal !== "all" && OPTIONS.subByCat && OPTIONS.subByCat[catVal]) list = OPTIONS.subByCat[catVal];
      else list = OPTIONS.subAll || [];

      const prev = fSub.value;
      fSub.innerHTML = `<option value="all">–í—Å–µ</option>` + list.map(s =>
        `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`
      ).join("");

      if (prev && (prev === "all" || list.includes(prev))) fSub.value = prev;
      else fSub.value = "all";
    }

    function renderBalances(){
      if (!BALANCES || BALANCES.length === 0){
        balancesBox.innerHTML = `<div class="muted">Qoldiq yo‚Äòq</div>`;
        return;
      }
      balancesBox.innerHTML = BALANCES.map(b => `
        <div class="balItem">
          <div>
            <div class="w">${escapeHtml(b.wallet)}</div>
            <div class="muted">UZS / USD</div>
          </div>
          <div class="nums">
            <div>${fmt(b.uzs)} <span class="muted">UZS</span></div>
            <div>${fmt(b.usd)} <span class="muted">USD</span></div>
          </div>
        </div>
      `).join("");
    }

    /************ filters + sums ************/
    function rowHasUZS(r){ return (toNum(r.kirimUzs) !== 0) || (toNum(r.chiqimUzs) !== 0); }
    function rowHasUSD(r){ return (toNum(r.kirimUsd) !== 0) || (toNum(r.chiqimUsd) !== 0); }
    function rowHasIN(r){ return (toNum(r.kirimUzs) > 0) || (toNum(r.kirimUsd) > 0); }
    function rowHasOUT(r){ return (toNum(r.chiqimUzs) > 0) || (toNum(r.chiqimUsd) > 0); }

    function applyFilters(){
      const df = dateFrom.value || "";
      const dt = dateTo.value || "";
      const w = fWallet.value;
      const c = fCat.value;
      const s = fSub.value;
      const t = fType.value;
      const cur = fCur.value;

      const filtered = ALL_ROWS.filter(r => {
        if (df && r.sana < df) return false;
        if (dt && r.sana > dt) return false;

        if (w !== "all" && r.koshelok !== w) return false;
        if (c !== "all" && r.kategoriya !== c) return false;
        if (s !== "all" && r.subkategoriya !== s) return false;

        if (t === "in" && !rowHasIN(r)) return false;
        if (t === "out" && !rowHasOUT(r)) return false;

        if (cur === "uzs" && !rowHasUZS(r)) return false;
        if (cur === "usd" && !rowHasUSD(r)) return false;
        if (cur === "both" && !(rowHasUZS(r) && rowHasUSD(r))) return false;

        return true;
      });

      renderTotals(filtered);
      renderCategorySummary(filtered);
      renderOps(filtered);
    }

    function renderTotals(list){
      let inU=0, outU=0, inD=0, outD=0;
      for (const r of list){
        inU += toNum(r.kirimUzs);
        outU += toNum(r.chiqimUzs);
        inD += toNum(r.kirimUsd);
        outD += toNum(r.chiqimUsd);
      }
      tInU.textContent = fmt(inU);
      tOutU.textContent = fmt(outU);
      tInD.textContent = fmt(inD);
      tOutD.textContent = fmt(outD);
    }

    function renderCategorySummary(list){
      if (!list || list.length === 0){
        catBody.innerHTML = `<tr><td colspan="5" class="empty">Operatsiyalar yoq</td></tr>`;
        return;
      }

      const map = new Map();
      for (const r of list){
        const k = (r.kategoriya || "-").trim() || "-";
        if (!map.has(k)) map.set(k, {cat:k, inU:0, outU:0, inD:0, outD:0});
        const o = map.get(k);
        o.inU += toNum(r.kirimUzs);
        o.outU += toNum(r.chiqimUzs);
        o.inD += toNum(r.kirimUsd);
        o.outD += toNum(r.chiqimUsd);
      }

      // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—Å—Ö–æ–¥—É UZS+USD (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ —Å–≤–µ—Ä—Ö—É)
      const arr = Array.from(map.values()).sort((a,b) => {
        const ao = (a.outU + a.outD);
        const bo = (b.outU + b.outD);
        return bo - ao;
      });

      catBody.innerHTML = arr.map(x => `
        <tr>
          <td class="catName" title="${escapeHtml(x.cat)}">${escapeHtml(x.cat)}</td>
          <td class="mono"><span class="${x.inU ? "in":""}">${fmt(x.inU)}</span></td>
          <td class="mono"><span class="${x.outU ? "out":""}">${fmt(x.outU)}</span></td>
          <td class="mono"><span class="${x.inD ? "in":""}">${fmt(x.inD)}</span></td>
          <td class="mono"><span class="${x.outD ? "out":""}">${fmt(x.outD)}</span></td>
        </tr>
      `).join("");
    }

    function renderOps(list){
      if (!list || list.length === 0){
        tbody.innerHTML = `<tr><td colspan="10" class="empty">Operatsiyalar yoq</td></tr>`;
        opsCards.innerHTML = `<div class="empty">Operatsiyalar yoq</div>`;
        return;
      }

      const sorted = [...list].sort((a,b) => (a.sana < b.sana ? 1 : a.sana > b.sana ? -1 : 0));

      // desktop table
      tbody.innerHTML = sorted.map(r => {
        const inU = toNum(r.kirimUzs);
        const outU = toNum(r.chiqimUzs);
        const inD = toNum(r.kirimUsd);
        const outD = toNum(r.chiqimUsd);

        return `
          <tr>
            <td class="mono">${escapeHtml(r.sana || "-")}</td>
            <td>${escapeHtml(r.koshelok || "-")}</td>
            <td>${escapeHtml(r.kategoriya || "-")}</td>
            <td>${escapeHtml(r.subkategoriya || "-")}</td>
            <td title="${escapeHtml(r.izoh || "")}">${escapeHtml(r.izoh || "-")}</td>
            <td class="mono ${inU ? "amtIn":""}">${fmt(inU)}</td>
            <td class="mono ${outU ? "amtOut":""}">${fmt(outU)}</td>
            <td class="mono ${inD ? "amtIn":""}">${fmt(inD)}</td>
            <td class="mono ${outD ? "amtOut":""}">${fmt(outD)}</td>
            <td class="mono">${fmt(r.kurs)}</td>
          </tr>
        `;
      }).join("");

      // mobile cards (–¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∏—á–µ—Å–∫–∏)
      opsCards.innerHTML = sorted.map(r => {
        const inU = toNum(r.kirimUzs);
        const outU = toNum(r.chiqimUzs);
        const inD = toNum(r.kirimUsd);
        const outD = toNum(r.chiqimUsd);

        return `
          <div class="opCard">
            <div class="opTop">
              <div>${escapeHtml(r.sana || "-")}</div>
              <div>${escapeHtml(r.koshelok || "-")}</div>
            </div>
            <div class="opMid">
              <div>${escapeHtml(r.kategoriya || "-")} ‚Ä¢ ${escapeHtml(r.subkategoriya || "-")}</div>
              <div class="mono">${fmt(r.kurs)}</div>
            </div>
            <div class="opNote" title="${escapeHtml(r.izoh || "")}">${escapeHtml(r.izoh || "-")}</div>

            <div class="opAmts">
              <div class="box">
                <div class="lbl">UZS</div>
                <div class="val">
                  <span class="${inU ? "amtIn":""}">+${fmt(inU)}</span>
                  &nbsp; / &nbsp;
                  <span class="${outU ? "amtOut":""}">-${fmt(outU)}</span>
                </div>
              </div>
              <div class="box">
                <div class="lbl">USD</div>
                <div class="val">
                  <span class="${inD ? "amtIn":""}">+${fmt(inD)}</span>
                  &nbsp; / &nbsp;
                  <span class="${outD ? "amtOut":""}">-${fmt(outD)}</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join("");

      if (!isMobile()) tableScroll.scrollTop = 0;
    }

    /************ login/boot ************/
    function setDataFromApi(res){
      ALL_ROWS = res.rows || [];
      OPTIONS = res.options || OPTIONS;
      BALANCES = res.balances || BALANCES;
      updatedAt.textContent = res.updatedAt ? ("update: " + res.updatedAt) : "";

      renderOptions();
      renderBalances();

      // –¥–∞—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = —Å–µ–≥–æ–¥–Ω—è (–¥–ª—è –ø–æ–∫–∞–∑–∞)
      const t = todayISO();
      if (!dateFrom.value) dateFrom.value = t;
      if (!dateTo.value) dateTo.value = t;

      applyFilters();
    }

    async function doLogin(){
      hideLoginMsg();
      const lg = inpLogin.value.trim();
      const ps = inpPass.value.trim();
      if (!lg || !ps){
        setLoginMsg("err","Login/Parol bo‚Äòsh");
        return;
      }

      btnLogin.disabled = true;
      setLoginMsg("", "Bazani yuklayapmiz...", true);

      try{
        const res = await apiLogin(lg, ps);
        if (!res || !res.ok){
          setLoginMsg("err", "Login yoki parol xato");
          return;
        }

        TOKEN = res.token;
        USER = res.user;
        localStorage.setItem("bps_token", TOKEN);

        userPill.textContent = `üë§ ${USER?.ism || USER?.login || "-"}`;

        setDataFromApi(res);
        setStatus("ok","Tayyor");
        loginOverlay.style.display = "none";
      }catch(e){
        console.error(e);
        setLoginMsg("err","Xatolik: serverga ulanib bo‚Äòlmadi");
      }finally{
        btnLogin.disabled = false;
      }
    }

    async function bootByToken(){
      if (!TOKEN) return;
      setStatus("", "Yuklanmoqda...", true);
      try{
        const res = await apiRefresh(TOKEN);
        if (!res || !res.ok) throw new Error(res?.error || "bad_response");
        setDataFromApi(res);
        setStatus("ok","Tayyor");
        loginOverlay.style.display = "none";
      }catch(e){
        console.warn("token invalid:", e);
        localStorage.removeItem("bps_token");
        TOKEN = "";
        loginOverlay.style.display = "";
      }
    }

    function resetFilters(){
      const t = todayISO();
      dateFrom.value = t;
      dateTo.value = t;
      fWallet.value = "all";
      fCat.value = "all";
      renderSubOptions("all");
      fSub.value = "all";
      fType.value = "all";
      fCur.value = "all";
      applyFilters();
    }

    /************ table drag-scroll right click (both axes) ************/
    function enableRightDragScroll(el){
      let dragging = false;
      let startX=0, startY=0, startLeft=0, startTop=0;

      el.addEventListener("contextmenu", (e) => e.preventDefault());

      el.addEventListener("mousedown", (e) => {
        if (e.button !== 2) return;
        dragging = true;
        startX = e.clientX;
        startY = e.clientY;
        startLeft = el.scrollLeft;
        startTop = el.scrollTop;
        el.style.cursor = "grabbing";
        e.preventDefault();
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        el.scrollLeft = startLeft - dx;
        el.scrollTop = startTop - dy;
      });

      window.addEventListener("mouseup", (e) => {
        if (e.button !== 2) return;
        dragging = false;
        el.style.cursor = "";
      });
    }

    /************ events ************/
    btnLogin.addEventListener("click", doLogin);
    inpPass.addEventListener("keydown", (e)=>{ if(e.key==="Enter") doLogin(); });

    btnReload.addEventListener("click", async () => {
      if (!TOKEN) return;
      setStatus("", "Yangilanmoqda...", true);
      btnReload.disabled = true;
      try{
        const res = await apiRefresh(TOKEN);
        if (!res || !res.ok) throw new Error(res?.error || "bad_response");
        setDataFromApi(res);
        setStatus("ok","Yangilandi");
      }catch(e){
        console.error(e);
        setStatus("err","Xatolik");
      }finally{
        btnReload.disabled = false;
      }
    });

    btnClear.addEventListener("click", resetFilters);

    dateFrom.addEventListener("change", applyFilters);
    dateTo.addEventListener("change", applyFilters);
    fWallet.addEventListener("change", applyFilters);

    fCat.addEventListener("change", () => {
      renderSubOptions(fCat.value);
      applyFilters();
    });
    fSub.addEventListener("change", applyFilters);
    fType.addEventListener("change", applyFilters);
    fCur.addEventListener("change", applyFilters);

    // mobile menu
    burger.addEventListener("click", () => {
      mOverlay.style.display = "block";
    });
    mOverlay.addEventListener("click", () => {
      mOverlay.style.display = "none";
    });

    // re-render ops on resize (switch table/cards)
    window.addEventListener("resize", () => {
      applyFilters();
    });

    /************ icons (inline svg) ************/
    function svgIcon(pathD){
      return `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <path d="${pathD}" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      `;
    }
    function homeIcon(){ return svgIcon("M3 10.5L12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1v-10.5z"); }
    function cashIcon(){ return svgIcon("M4 7h16v10H4V7zm3 3h4m6 0h2m-2 4h2M8 14h2"); }
    function factoryIcon(){ return svgIcon("M3 21V10l6 3V9l6 4V9l6 4v8H3zm4 0v-5h3v5m4 0v-5h3v5"); }
    function saleIcon(){ return svgIcon("M7 7h10l-1 12H8L7 7zm2-3h6v3H9V4z"); }
    function boxIcon(){ return svgIcon("M21 8l-9-5-9 5 9 5 9-5zM3 8v8l9 5 9-5V8"); }
    function usersIcon(){ return svgIcon("M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8m10 10v-2a4 4 0 0 0-3-3.87"); }

    /************ init ************/
    renderNav();
    enableRightDragScroll(tableScroll);

    // default date today
    resetFilters();
    bootByToken();
  </script>
</body>
</html>
